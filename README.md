# faultit
Make changes to your code while keeping whose at fault.

### Why
Sometimes when working on legacy codebases some formatting is needed.
Formatting using any of the known tools such as black, yapf, or whichever you prefer, leaves you with better code but none of the original authors.

Faultit is built as a tool to match modified lines with the lines before the changes and apply _new commits_ with the _original authors_.
This leaves you with both the formatted code and the original authors when looking at the blame.

### Installation

```bash
pip install faultit
```

### Usage

```bash
black .
faultit
```

### Features

- Match code based on similar words
- Group all lines changed by a commit to a new commit across all lines
- Generates commit with the same author as the original author

### Example

Using faultit on this code after running black:

```python
Adam  2015-04-14 ...    def some_func(self, arg):
Adam  2015-04-14 ...        assert SomeClass.__name__ in obj.clients, \
Eve   2018-11-05 ...            '{} is adding itself to {} clients.' \
Eve   2018-11-05 ...                .format(self.__class__.__name__, SomeClass.__name__)
John  2016-11-16 ...        obj.property = self.property
Eve   2016-12-15 ...        obj.long_property_name = self.long_property_name
Adam  2015-04-14 ...        obj.clients[
Adam  2015-04-14 ...            self.__class__.__name__
Adam  2015-04-14 ...        ] = self
Adam  2015-04-14 ...
Pete  2015-05-01 ...        obj.prop_dic.setdefault(self.SOME_LONG_NAME_CONST,
Pete  2015-05-01 ...                                SOME_LONG_NAME_CONST_DEFAULT)
```

Will leave you with:
```python
Adam  2015-04-14 ...  def some_func(self, arg):
Adam  2015-04-14 ...      assert (
Adam  2015-04-14 ...          SomeClass.__name__ in obj.clients
Eve   2018-11-05 ...      ), "{} is adding itself to {} clients.".format(
Eve   2018-11-05 ...          self.__class__.__name__, SomeClass.__name__
Eve   2018-11-05 ...      )
John  2016-11-16 ...      obj.property = self.property
Eve   2016-12-15 ...      obj.long_property_name = self.long_property_name
Adam  2015-04-14 ...      obj.clients[self.__class__.__name__] = self
Adam  2015-04-14 ...
Pete  2015-05-01 ...      obj.prop_dic.setdefault(
Pete  2015-05-01 ...          self.SOME_LONG_NAME_CONST, SOME_LONG_NAME_CONST_DEFAULT
Pete  2015-05-01 ...      )
```

### How does it work

Faultit looks at the diffs generated by git and for each diff tries to match lines by similarity.
If it cannot find a line to match to, faultit will try to match the line in the same offset in the diff.

### Thanks

This project is largly based on [this project by Alaya Care](https://github.com/AlayaCare/git-black).
I opted into making a new codebase to make it more extendable.

### Roadmap

- [ ] Add proper test suite
- [ ] Make faultit configurable
- [ ] Support other formatters that move lines around (isort)
- [ ] Add progress bar
